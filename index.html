<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="screen-orientation" content="landscape">
    <meta name="theme-color" content="#1a1a2e">
    <title>2D Pool Game</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <script type="importmap">
    {
        "imports": {
            "planck": "https://esm.sh/planck-js@1.0.6"
        }
    }
    </script>
</head>
<body>
    <div id="loading-screen">
        <div class="loading-content">
            <h1>2D Pool</h1>
            <div class="loading-spinner"></div>
            <p>Loading...</p>
        </div>
    </div>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div id="ui-overlay">
            <div id="main-menu" class="menu menu-compact">
                <h1>2D Pool</h1>
                <div class="menu-grid">
                    <!-- Table Selector Card -->
                    <div class="selector-card" id="table-selector">
                        <div class="card-label">Table</div>
                        <div class="card-preview">
                            <canvas id="table-preview" width="240" height="120"></canvas>
                        </div>
                        <div class="card-footer">
                            <div class="card-name" id="table-name">Classic Green</div>
                            <button class="card-btn" id="btn-change-table">Change</button>
                        </div>
                    </div>
                    <!-- Ball Set Selector Card -->
                    <div class="selector-card" id="ball-selector">
                        <div class="card-label">Ball Set</div>
                        <div class="card-preview ball-preview" id="ball-set-preview"></div>
                        <div class="card-footer">
                            <div class="card-name" id="ball-set-name">American</div>
                            <button class="card-btn" id="btn-change-balls">Change</button>
                        </div>
                    </div>
                    <!-- Game Mode Card -->
                    <div class="selector-card game-mode-card">
                        <div class="card-label">Game Mode</div>
                        <div class="match-format-row">
                            <label for="match-format">Match</label>
                            <select id="match-format">
                                <option value="1">Single Frame</option>
                                <option value="3">Best of 3</option>
                                <option value="5">Best of 5</option>
                                <option value="7">Best of 7</option>
                            </select>
                        </div>
                        <div class="game-mode-buttons">
                            <button id="btn-8ball" class="mode-btn">8-Ball (US)</button>
                            <button id="btn-uk8ball" class="mode-btn">8-Ball (UK)</button>
                            <button id="btn-9ball" class="mode-btn">9-Ball</button>
                            <button id="btn-snooker" class="mode-btn">Snooker</button>
                            <button id="btn-freeplay" class="mode-btn">Free Play</button>
                        </div>
                        <button id="btn-resume-match" class="mode-btn resume-btn hidden">
                            Resume Match <span class="resume-info"></span>
                        </button>
                    </div>
                </div>
                <button id="btn-fullscreen" class="menu-btn small mobile-only">Fullscreen</button>
                <!-- Hidden elements for compatibility -->
                <input type="checkbox" id="sound-toggle" checked style="display:none">
                <input type="range" id="speed-slider" min="0.2" max="2" step="0.1" value="1" style="display:none">
                <span id="speed-value" style="display:none">1.0x</span>
                <select id="table-select" style="display:none">
                    <option value="1">Classic Green</option>
                    <option value="2">Blue Felt</option>
                    <option value="3">Red Felt</option>
                    <option value="4">Tournament</option>
                    <option value="5">Luxury</option>
                    <option value="6">Glass</option>
                    <option value="7">UK Pub</option>
                    <option value="8">Mini Snooker</option>
                    <option value="9">Full-Size Snooker</option>
                </select>
                <select id="uk-color-scheme" style="display:none">
                    <option value="red-yellow">Red/Yellow</option>
                    <option value="blue-yellow">Blue/Yellow</option>
                </select>
            </div>

            <!-- Table Selection Modal -->
            <div id="table-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Select Table</h2>
                        <button class="modal-close" id="close-table-modal">&times;</button>
                    </div>
                    <div class="table-grid" id="table-grid">
                        <!-- Table thumbnails will be populated by JS -->
                    </div>
                    <button class="create-custom-btn" id="btn-create-custom-table">+ Create Custom Table</button>
                </div>
            </div>

            <!-- Ball Set Selection Modal -->
            <div id="ball-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Select Ball Set</h2>
                        <button class="modal-close" id="close-ball-modal">&times;</button>
                    </div>
                    <div class="ball-set-grid" id="ball-set-grid">
                        <!-- Ball set previews will be populated by JS -->
                    </div>
                    <button class="create-custom-btn" id="btn-create-custom">+ Create Custom Set</button>
                </div>
            </div>

            <!-- Custom Ball Set Creator Modal -->
            <div id="creator-modal" class="modal hidden">
                <div class="modal-content creator-content">
                    <div class="modal-header">
                        <h2>Create Custom Ball Set</h2>
                        <button class="modal-close" id="close-creator-modal">&times;</button>
                    </div>
                    <div class="creator-layout-v2">
                        <div class="creator-row">
                            <div class="creator-field name-field">
                                <label for="custom-set-name">Set Name</label>
                                <input type="text" id="custom-set-name" placeholder="My Custom Set" maxlength="20">
                            </div>
                            <div class="creator-field">
                                <label>Style</label>
                                <div class="style-toggle">
                                    <button class="style-btn active" data-style="solid" id="style-solid">Solid</button>
                                    <button class="style-btn" data-style="stripe" id="style-stripe">Spots & Stripes</button>
                                </div>
                            </div>
                        </div>

                        <div class="creator-preview-row">
                            <div class="preview-balls" id="creator-preview-balls"></div>
                        </div>

                        <!-- Solid mode options -->
                        <div class="solid-options" id="solid-options">
                            <div class="color-row">
                                <div class="color-field-hsb">
                                    <label>Group 1 (1-7)</label>
                                    <button class="color-swatch" id="swatch-group1" data-color-id="group1" data-color="#CC0000" style="background-color: #CC0000;"></button>
                                </div>
                                <div class="color-field-hsb">
                                    <label>Group 2 (9-15)</label>
                                    <button class="color-swatch" id="swatch-group2" data-color-id="group2" data-color="#FFD700" style="background-color: #FFD700;"></button>
                                </div>
                                <div class="color-field-hsb">
                                    <label>8-Ball</label>
                                    <button class="color-swatch" id="swatch-8ball" data-color-id="8ball" data-color="#000000" style="background-color: #000000;"></button>
                                </div>
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="striped-8ball">
                                Striped 8-Ball
                            </label>

                            <!-- Number styling for 8-ball (always visible in solid mode) -->
                            <div class="solid-number-styling" id="solid-number-styling">
                                <div class="section-label">8-Ball Number Styling</div>
                                <div class="color-row">
                                    <div class="color-field-hsb">
                                        <label>Stripe Background</label>
                                        <button class="color-swatch" id="swatch-solid-stripe-bg" data-color-id="solid-stripe-bg" data-color="#FFFFFF" style="background-color: #FFFFFF;"></button>
                                    </div>
                                    <div class="color-field-hsb">
                                        <label>Number Circle</label>
                                        <button class="color-swatch" id="swatch-solid-number-circle" data-color-id="solid-number-circle" data-color="#FFFFFF" style="background-color: #FFFFFF;"></button>
                                    </div>
                                    <div class="color-field-hsb">
                                        <label>Number Text</label>
                                        <button class="color-swatch" id="swatch-solid-number-text" data-color-id="solid-number-text" data-color="#000000" style="background-color: #000000;"></button>
                                    </div>
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="solid-number-border">
                                    Number Border
                                </label>
                                <div class="color-field-hsb hidden" id="solid-border-color-field">
                                    <label>Border Color</label>
                                    <button class="color-swatch" id="swatch-solid-number-border" data-color-id="solid-number-border" data-color="#000000" style="background-color: #000000;"></button>
                                </div>
                                <div class="ball-slider-group">
                                    <label for="solid-radial-lines">
                                        Radial Lines
                                        <span class="slider-value" id="solid-radial-lines-value">0</span>
                                    </label>
                                    <input type="range" id="solid-radial-lines" min="0" max="12" value="0" step="1">
                                </div>
                                <div class="ball-slider-group">
                                    <label for="solid-stripe-thickness">
                                        Stripe Thickness
                                        <span class="slider-value" id="solid-stripe-thickness-value">0.55</span>
                                    </label>
                                    <input type="range" id="solid-stripe-thickness" min="0.2" max="0.8" value="0.55" step="0.01">
                                </div>
                                <div class="ball-slider-group">
                                    <label for="solid-circle-radius">
                                        Circle Radius
                                        <span class="slider-value" id="solid-circle-radius-value">0.66</span>
                                    </label>
                                    <input type="range" id="solid-circle-radius" min="0.5" max="1.0" value="0.66" step="0.01">
                                </div>
                            </div>
                        </div>

                        <!-- Stripe mode options -->
                        <div class="stripe-options hidden" id="stripe-mode-options">
                            <div class="color-row" id="simple-color-pickers">
                                <div class="color-field-hsb">
                                    <label>Solids (1-7)</label>
                                    <button class="color-swatch" id="swatch-solids" data-color-id="solids" data-color="#FFD700" style="background-color: #FFD700;"></button>
                                </div>
                                <div class="color-field-hsb">
                                    <label>Stripes (9-15)</label>
                                    <button class="color-swatch" id="swatch-stripes" data-color-id="stripes" data-color="#0000CD" style="background-color: #0000CD;"></button>
                                </div>
                                <div class="color-field-hsb">
                                    <label>8-Ball</label>
                                    <button class="color-swatch" id="swatch-8ball-stripe" data-color-id="8ball-stripe" data-color="#000000" style="background-color: #000000;"></button>
                                </div>
                                <div class="color-field-hsb">
                                    <label>Stripe Background</label>
                                    <button class="color-swatch" id="swatch-stripe-bg" data-color-id="stripe-bg" data-color="#FFFFFF" style="background-color: #FFFFFF;"></button>
                                </div>
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="striped-8ball-stripe">
                                Striped 8-Ball
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="advanced-mode">
                                Individual Ball Colors
                            </label>
                            <div class="advanced-color-pickers hidden" id="advanced-color-pickers">
                                <div class="ball-color-grid">
                                    <div class="color-field-hsb ball-color"><label>1 & 9</label><button class="color-swatch" data-pair="1" data-color-id="pair-1" data-color="#FFD700" style="background-color: #FFD700;"></button></div>
                                    <div class="color-field-hsb ball-color"><label>2 & 10</label><button class="color-swatch" data-pair="2" data-color-id="pair-2" data-color="#0000CD" style="background-color: #0000CD;"></button></div>
                                    <div class="color-field-hsb ball-color"><label>3 & 11</label><button class="color-swatch" data-pair="3" data-color-id="pair-3" data-color="#FF0000" style="background-color: #FF0000;"></button></div>
                                    <div class="color-field-hsb ball-color"><label>4 & 12</label><button class="color-swatch" data-pair="4" data-color-id="pair-4" data-color="#4B0082" style="background-color: #4B0082;"></button></div>
                                    <div class="color-field-hsb ball-color"><label>5 & 13</label><button class="color-swatch" data-pair="5" data-color-id="pair-5" data-color="#FF8C00" style="background-color: #FF8C00;"></button></div>
                                    <div class="color-field-hsb ball-color"><label>6 & 14</label><button class="color-swatch" data-pair="6" data-color-id="pair-6" data-color="#006400" style="background-color: #006400;"></button></div>
                                    <div class="color-field-hsb ball-color"><label>7 & 15</label><button class="color-swatch" data-pair="7" data-color-id="pair-7" data-color="#800000" style="background-color: #800000;"></button></div>
                                    <div class="color-field-hsb ball-color"><label>8</label><button class="color-swatch" data-pair="8" data-color-id="pair-8" data-color="#000000" style="background-color: #000000;"></button></div>
                                </div>
                            </div>
                            <div class="number-style-row">
                                <div class="color-field-hsb">
                                    <label>Number Circle</label>
                                    <button class="color-swatch" id="swatch-number-circle" data-color-id="number-circle" data-color="#FFFFFF" style="background-color: #FFFFFF;"></button>
                                </div>
                                <div class="color-field-hsb">
                                    <label>Number Text</label>
                                    <button class="color-swatch" id="swatch-number-text" data-color-id="number-text" data-color="#000000" style="background-color: #000000;"></button>
                                </div>
                                <label class="checkbox-label border-checkbox">
                                    <input type="checkbox" id="number-border">
                                    Border
                                </label>
                                <div class="color-field-hsb border-color-field hidden" id="border-color-field">
                                    <button class="color-swatch" id="swatch-number-border" data-color-id="number-border" data-color="#000000" style="background-color: #000000;"></button>
                                </div>
                            </div>
                            <div class="ball-slider-group">
                                <label for="radial-lines">
                                    Radial Lines (requires border)
                                    <span class="slider-value" id="radial-lines-value">0</span>
                                </label>
                                <input type="range" id="radial-lines" min="0" max="24" value="0" step="1" disabled>
                            </div>
                            <div class="ball-slider-group">
                                <label for="stripe-thickness">
                                    Stripe Thickness
                                    <span class="slider-value" id="stripe-thickness-value">0.55</span>
                                </label>
                                <input type="range" id="stripe-thickness" min="0.2" max="0.8" value="0.55" step="0.01">
                            </div>
                            <div class="ball-slider-group">
                                <label for="circle-radius">
                                    Circle Radius
                                    <span class="slider-value" id="circle-radius-value">0.66</span>
                                </label>
                                <input type="range" id="circle-radius" min="0.5" max="1.0" value="0.66" step="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="creator-actions">
                        <button class="cancel-btn" id="btn-cancel-creator">Cancel</button>
                        <button class="save-btn" id="btn-save-custom">Save Ball Set</button>
                    </div>
                </div>
            </div>

            <!-- Custom Table Creator Modal -->
            <div id="table-creator-modal" class="modal hidden">
                <div class="modal-content table-creator-content">
                    <div class="modal-header">
                        <h2>Create Custom Table</h2>
                        <button class="modal-close" id="close-table-creator-modal">&times;</button>
                    </div>
                    <div class="table-creator-layout">
                        <div class="creator-field name-field">
                            <label for="custom-table-name">Table Name</label>
                            <input type="text" id="custom-table-name" placeholder="My Custom Table" maxlength="30">
                        </div>

                        <div class="creator-field">
                            <label for="base-table-select">Base Table</label>
                            <select id="base-table-select" class="base-table-select">
                                <option value="1">Classic Green</option>
                                <option value="2">Blue Felt</option>
                                <option value="3">Red Felt</option>
                                <option value="4">Tournament</option>
                                <option value="8">Mini Snooker</option>
                                <option value="9">Full-Size Snooker</option>
                            </select>
                        </div>

                        <div class="table-preview-container">
                            <label>Preview</label>
                            <canvas id="table-creator-preview" width="400" height="200"></canvas>
                        </div>

                        <div class="hsb-controls">
                            <div class="hsb-slider-group">
                                <label for="table-hue">
                                    Hue
                                    <span class="slider-value" id="table-hue-value">0°</span>
                                </label>
                                <input type="range" id="table-hue" min="0" max="360" value="0" step="1">
                            </div>

                            <div class="hsb-slider-group">
                                <label for="table-saturation">
                                    Saturation
                                    <span class="slider-value" id="table-saturation-value">100%</span>
                                </label>
                                <input type="range" id="table-saturation" min="0" max="200" value="100" step="1">
                            </div>

                            <div class="hsb-slider-group">
                                <label for="table-brightness">
                                    Brightness
                                    <span class="slider-value" id="table-brightness-value">100%</span>
                                </label>
                                <input type="range" id="table-brightness" min="0" max="200" value="100" step="1">
                            </div>
                        </div>
                    </div>
                    <div class="creator-actions">
                        <button class="cancel-btn" id="btn-cancel-table-creator">Cancel</button>
                        <button class="save-btn" id="btn-save-table">Save Table</button>
                    </div>
                </div>
            </div>

            <!-- HSB Color Picker Modal -->
            <div id="color-picker-modal" class="modal hidden">
                <div class="modal-content color-picker-content">
                    <div class="modal-header">
                        <h2 id="color-picker-title">Select Color</h2>
                        <button class="modal-close" id="close-color-picker-modal">&times;</button>
                    </div>
                    <div class="color-picker-body">
                        <div class="color-preview-large" id="color-preview-large"></div>
                        <div class="hsb-controls">
                            <div class="hsb-slider-group">
                                <label for="color-hue">
                                    Hue
                                    <span class="slider-value" id="color-hue-value">0°</span>
                                </label>
                                <input type="range" id="color-hue" min="0" max="360" value="0" step="1">
                            </div>
                            <div class="hsb-slider-group">
                                <label for="color-saturation">
                                    Saturation
                                    <span class="slider-value" id="color-saturation-value">100%</span>
                                </label>
                                <input type="range" id="color-saturation" min="0" max="100" value="100" step="1">
                            </div>
                            <div class="hsb-slider-group">
                                <label for="color-brightness">
                                    Brightness
                                    <span class="slider-value" id="color-brightness-value">100%</span>
                                </label>
                                <input type="range" id="color-brightness" min="0" max="100" value="100" step="1">
                            </div>
                        </div>
                    </div>
                    <div class="creator-actions">
                        <button class="cancel-btn" id="btn-cancel-color-picker">Cancel</button>
                        <button class="save-btn" id="btn-apply-color">Apply</button>
                    </div>
                </div>
            </div>

            <div id="game-hud" class="hidden">
                <!-- Left Panel - 25% - Game Info -->
                <div id="hud-info-panel" class="hud-panel">
                    <button id="btn-game-menu" class="game-menu-btn" title="Menu">&#x2630;</button>
                    <div id="game-menu-dropdown" class="game-menu-dropdown hidden">
                        <button id="btn-quit-game" class="game-menu-item">Quit to Menu</button>
                    </div>
                    <span id="hud-mode-name">8-Ball</span>
                    <span id="hud-turn-indicator">Player 1's Turn</span>
                    <span id="hud-two-shot" class="hud-badge hidden">2 shots</span>
                    <span id="hud-snooker-break" class="hud-badge snooker-break-badge hidden">Break: 0</span>
                    <span id="hud-snooker-target" class="hud-target hidden"></span>
                </div>

                <!-- Right Panel - 75% - Players & Scores -->
                <div id="hud-players-panel" class="hud-panel">
                    <div class="hud-player" id="hud-player-1">
                        <span class="player-name">Player 1</span>
                        <div class="player-ball-group" id="p1-ball-group"></div>
                        <span class="player-point-score" id="p1-point-score"></span>
                    </div>
                    <div class="hud-scores" id="hud-scores">
                        <span id="p1-frames">0</span>
                        <span class="score-bestof" id="score-bestof">(1)</span>
                        <span id="p2-frames">0</span>
                    </div>
                    <div class="hud-player" id="hud-player-2">
                        <span class="player-point-score" id="p2-point-score"></span>
                        <div class="player-ball-group" id="p2-ball-group"></div>
                        <span class="player-name">Player 2</span>
                    </div>
                </div>

                <!-- Legacy elements (kept for compatibility but may be hidden) -->
                <div id="player-indicator" class="hidden"></div>
                <div id="ball-groups"></div>
                <div id="foul-indicator" class="hidden">FOUL</div>
                <div id="game-message"></div>
                <div id="touch-hint" class="mobile-only">Touch &amp; drag to aim, release to shoot</div>
            </div>
            <div id="snooker-hud" class="hidden">
                <div id="snooker-score"></div>
                <div id="snooker-break" class="hidden"></div>
                <div id="snooker-target"></div>
            </div>
            <div id="game-over" class="menu hidden">
                <h2 id="winner-text"></h2>
                <div id="frame-score-display" class="frame-score-display hidden">
                    <span id="frame-p1-score">0</span>
                    <span class="frame-score-sep">-</span>
                    <span id="frame-p2-score">0</span>
                </div>
                <div class="menu-buttons">
                    <button id="btn-next-frame" class="menu-btn hidden">Next Frame</button>
                    <button id="btn-play-again" class="menu-btn">Play Again</button>
                    <button id="btn-main-menu" class="menu-btn">Main Menu</button>
                </div>
            </div>
            <div id="freeplay-controls" class="hidden">
                <button id="btn-rerack" class="menu-btn small">Re-rack</button>
                <button id="btn-exit-freeplay" class="menu-btn small">Exit</button>
            </div>
        </div>
        <button id="btn-fullscreen-float" class="fullscreen-float mobile-only" title="Fullscreen">&#x26F6;</button>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
